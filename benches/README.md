# solar-bench

Simple benchmarks across different Solidity parser implementations.

Requires cloning submodules: `git submodule update --init --checkout`.

Run with:

```bash
# Criterion
cargo bench -p solar-bench --bench criterion -- --quiet --format terse parser |& tee benches/criterion.out
uv --project benches/analyze run benches/analyze/main.py benches/README.md < benches/criterion.out

# iai - requires `valgrind` and `iai-callgrind-runner`
cargo bench -p solar-bench --bench iai
```

Currently this takes around 30 minutes to complete: `sources (12) * parsers (5) * lexers (2) * 15s`.

This crate is excluded from the main workspace to avoid compiling it (and its dependencies) when
invoking other commands such as `cargo test`.

## Results

You view the Solar-only results on [codspeed.io](https://codspeed.io/paradigmxyz/solar).

The following results were achieved on:
- Target: `x86_64-unknown-linux-gnu`
- CPU: AMD Ryzen 9 7950X
- Versions:
  - [`solc 0.8.28`](https://github.com/ethereum/solidity)
  - [`solar 0.1.2`](../README.md)
  - [`solang-parser 0.3.4`](https://crates.io/crates/solang-parser)
  - [`slang 0.18.3`](https://crates.io/crates/slang)
  - [`tree-sitter 0.25.4`](https://crates.io/crates/tree-sitter), [`tree-sitter-solidity 1.2.11`](https://crates.io/crates/tree-sitter-solidity)

<!-- AUTOGENERATED MARKER -->

![lex Relative Performance](lex_relative_performance.png)

![parse Relative Performance](parse_relative_performance.png)

### empty (0 LoC, 0 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solang   | 14.25x     | 8.0135 ns | N/A     | N/A       |
| solar    | 1.00x      | 114.86 ns | N/A     | N/A       |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solang      | 41.07x     | 89.695 ns | N/A     | N/A       |
| solar       | 13.19x     | 277.61 ns | N/A     | N/A       |
| tree-sitter | 8.52x      | 429.22 ns | N/A     | N/A       |
| solc        | 3.65x      | 1.0000 µs | N/A     | N/A       |
| slang       | 1.00x      | 3.6558 µs | N/A     | N/A       |

### Counter (14 LoC, 258 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.58x      | 924.04 ns | 15.15M  | 279.22M   |
| solang   | 1.00x      | 1.4643 µs | 9.56M   | 176.23M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 75.08x     | 2.4872 µs | 5.63M   | 103.74M   |
| solang      | 23.45x     | 7.9632 µs | 1.76M   | 32.40M    |
| tree-sitter | 15.81x     | 11.809 µs | 1.19M   | 21.85M    |
| solc        | 6.77x      | 27.600 µs | 507.25K | 9.35M     |
| slang       | 1.00x      | 186.73 µs | 74.97K  | 1.38M     |

### verifier (208 LoC, 11040 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.78x      | 34.428 µs | 6.04M   | 320.67M   |
| solang   | 1.00x      | 61.116 µs | 3.40M   | 180.64M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 113.24x    | 85.612 µs | 2.43M   | 128.95M   |
| solang      | 22.79x     | 425.40 µs | 488.95K | 25.95M    |
| solc        | 14.74x     | 657.90 µs | 316.16K | 16.78M    |
| tree-sitter | 12.71x     | 762.64 µs | 272.74K | 14.48M    |
| slang       | 1.00x      | 9.6949 ms | 21.45K  | 1.14M     |

### OptimizorClub (782 LoC, 35905 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.67x      | 110.94 µs | 7.05M   | 323.64M   |
| solang   | 1.00x      | 185.07 µs | 4.23M   | 194.01M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 107.29x    | 243.06 µs | 3.22M   | 147.72M   |
| solang      | 21.18x     | 1.2311 ms | 635.20K | 29.16M    |
| solc        | 16.32x     | 1.5981 ms | 489.33K | 22.47M    |
| tree-sitter | 12.67x     | 2.0586 ms | 379.87K | 17.44M    |
| slang       | 1.00x      | 26.078 ms | 29.99K  | 1.38M     |

### UniswapV3 (3189 LoC, 146583 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.09x      | 301.48 µs | 10.58M  | 486.21M   |
| solang   | 1.00x      | 629.97 µs | 5.06M   | 232.68M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 107.80x    | 655.63 µs | 4.86M   | 223.58M   |
| solang      | 22.30x     | 3.1697 ms | 1.01M   | 46.25M    |
| solc        | 15.20x     | 4.6515 ms | 685.59K | 31.51M    |
| tree-sitter | 12.37x     | 5.7161 ms | 557.90K | 25.64M    |
| slang       | 1.00x      | 70.680 ms | 45.12K  | 2.07M     |

### Solarray (1544 LoC, 35898 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.38x      | 206.01 µs | 7.49M   | 174.25M   |
| solang   | 1.00x      | 283.66 µs | 5.44M   | 126.55M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 124.17x    | 530.41 µs | 2.91M   | 67.68M    |
| solc        | 29.04x     | 2.2681 ms | 680.75K | 15.83M    |
| solang      | 26.34x     | 2.5006 ms | 617.45K | 14.36M    |
| tree-sitter | 16.59x     | 3.9700 ms | 388.92K | 9.04M     |
| slang       | 1.00x      | 65.860 ms | 23.44K  | 545.07K   |

### console (1552 LoC, 67315 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.49x      | 293.55 µs | 5.29M   | 229.31M   |
| solang   | 1.00x      | 437.97 µs | 3.54M   | 153.70M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 110.70x    | 641.07 µs | 2.42M   | 105.00M   |
| solang      | 22.74x     | 3.1212 ms | 497.24K | 21.57M    |
| solc        | 20.45x     | 3.4701 ms | 447.25K | 19.40M    |
| tree-sitter | 14.00x     | 5.0691 ms | 306.17K | 13.28M    |
| slang       | 1.00x      | 70.968 ms | 21.87K  | 948.53K   |

### Vm (1763 LoC, 91405 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.22x      | 175.80 µs | 10.03M  | 519.94M   |
| solang   | 1.00x      | 390.57 µs | 4.51M   | 234.03M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 60.57x     | 316.62 µs | 5.57M   | 288.69M   |
| solang      | 14.02x     | 1.3676 ms | 1.29M   | 66.84M    |
| tree-sitter | 8.45x      | 2.2702 ms | 776.58K | 40.26M    |
| solc        | 7.79x      | 2.4631 ms | 715.76K | 37.11M    |
| slang       | 1.00x      | 19.179 ms | 91.92K  | 4.77M     |

### safeconsole (13248 LoC, 397898 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.46x      | 1.5444 ms | 8.58M   | 257.64M   |
| solang   | 1.00x      | 2.2565 ms | 5.87M   | 176.33M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 84.60x     | 4.8621 ms | 2.72M   | 81.84M    |
| solang      | 21.95x     | 18.742 ms | 706.86K | 21.23M    |
| tree-sitter | 20.96x     | 19.626 ms | 675.02K | 20.27M    |
| solc        | 19.07x     | 21.565 ms | 614.32K | 18.45M    |
| slang       | 1.00x      | 411.31 ms | 32.21K  | 967.39K   |

### Seaport (19935 LoC, 770547 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.16x      | 1.2944 ms | 15.40M  | 595.29M   |
| solang   | 1.00x      | 2.7960 ms | 7.13M   | 275.59M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 99.89x     | 2.4322 ms | 8.20M   | 316.81M   |
| solang      | 25.32x     | 9.5949 ms | 2.08M   | 80.31M    |
| solc        | 12.15x     | 19.990 ms | 997.24K | 38.55M    |
| tree-sitter | 11.84x     | 20.526 ms | 971.21K | 37.54M    |
| slang       | 1.00x      | 242.95 ms | 82.05K  | 3.17M     |

### Solady (31047 LoC, 1381235 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.67x      | 3.8275 ms | 8.11M   | 360.87M   |
| solang   | 1.00x      | 6.3895 ms | 4.86M   | 216.17M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 97.68x     | 8.4302 ms | 3.68M   | 163.84M   |
| solang      | 22.67x     | 36.322 ms | 854.77K | 38.03M    |
| tree-sitter | 16.19x     | 50.865 ms | 610.38K | 27.15M    |
| solc        | 15.89x     | 51.835 ms | 598.96K | 26.65M    |
| slang       | 1.00x      | 823.47 ms | 37.70K  | 1.68M     |

### Optimism (124413 LoC, 5383876 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.84x      | 15.618 ms | 7.97M   | 344.72M   |
| solang   | 1.00x      | 28.780 ms | 4.32M   | 187.07M   |

#### Parse
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 183.02x    | 34.864 ms | 3.57M   | 154.43M   |
| solang   | 35.84x     | 178.02 ms | 698.87K | 30.24M    |
| solc     | 29.60x     | 215.56 ms | 577.14K | 24.98M    |
| slang    | 1.00x      | 6.3807 s  | 19.50K  | 843.78K   |
