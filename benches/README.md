# solar-bench

Simple benchmarks across different Solidity parser implementations.

Requires cloning submodules: `git submodule update --init --checkout`.

Run with:

```bash
# Criterion
cargo bench -p solar-bench --bench criterion -- --quiet --format terse parser |& tee benches/criterion.out
uv --project benches/analyze run benches/analyze/main.py benches/README.md < benches/criterion.out

# iai - requires `valgrind` and `iai-callgrind-runner`
cargo bench -p solar-bench --bench iai
```

Currently this takes around 30 minutes to complete: `sources (12) * parsers (5) * lexers (2) * 15s`.

This crate is excluded from the main workspace to avoid compiling it (and its dependencies) when
invoking other commands such as `cargo test`.

## Results

You can view the Solar-only results on [codspeed.io](https://codspeed.io/paradigmxyz/solar).

The following results were achieved on:
- Target: `x86_64-unknown-linux-gnu`
- CPU: AMD Ryzen 9 7950X
- Versions:
  - [`solc 0.8.28`](https://github.com/ethereum/solidity)
  - [`solar 0.1.2`](../README.md)
  - [`solang-parser 0.3.4`](https://crates.io/crates/solang-parser)
  - [`slang 0.18.3`](https://crates.io/crates/slang)
  - [`tree-sitter 0.25.4`](https://crates.io/crates/tree-sitter), [`tree-sitter-solidity 1.2.11`](https://crates.io/crates/tree-sitter-solidity)

<!-- AUTOGENERATED MARKER -->

![lex Relative Performance](lex_relative_performance.png)

![parse Relative Performance](parse_relative_performance.png)

### empty (0 LoC, 0 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solang   | 3.71x      | 7.7143 ns | N/A     | N/A       |
| solar    | 1.00x      | 26.494 ns | N/A     | N/A       |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solang      | 34.40x     | 100.89 ns | N/A     | N/A       |
| solar       | 29.15x     | 118.45 ns | N/A     | N/A       |
| tree-sitter | 8.60x      | 400.60 ns | N/A     | N/A       |
| solc        | 3.44x      | 1.0000 µs | N/A     | N/A       |
| slang       | 1.00x      | 3.4406 µs | N/A     | N/A       |

### Counter (14 LoC, 258 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.97x      | 735.85 ns | 19.05M  | 351.02M   |
| solang   | 1.00x      | 1.4512 µs | 9.65M   | 177.81M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 82.17x     | 2.1279 µs | 6.58M   | 121.30M   |
| solang      | 22.52x     | 7.7606 µs | 1.80M   | 33.25M    |
| tree-sitter | 14.79x     | 11.820 µs | 1.18M   | 21.83M    |
| solc        | 5.39x      | 32.400 µs | 432.10K | 7.96M     |
| slang       | 1.00x      | 174.78 µs | 80.10K  | 1.48M     |

### verifier (208 LoC, 11040 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.08x      | 29.788 µs | 6.98M   | 370.62M   |
| solang   | 1.00x      | 62.057 µs | 3.35M   | 177.90M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 114.34x    | 80.094 µs | 2.60M   | 137.84M   |
| solang      | 22.74x     | 402.67 µs | 516.55K | 27.42M    |
| solc        | 14.37x     | 637.49 µs | 326.28K | 17.32M    |
| tree-sitter | 12.19x     | 751.51 µs | 276.78K | 14.69M    |
| slang       | 1.00x      | 9.1578 ms | 22.71K  | 1.21M     |

### OptimizorClub (782 LoC, 35905 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.92x      | 93.968 µs | 8.32M   | 382.10M   |
| solang   | 1.00x      | 180.87 µs | 4.32M   | 198.51M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 107.23x    | 231.51 µs | 3.38M   | 155.09M   |
| solang      | 21.14x     | 1.1742 ms | 665.99K | 30.58M    |
| solc        | 15.36x     | 1.6167 ms | 483.70K | 22.21M    |
| tree-sitter | 11.71x     | 2.1208 ms | 368.73K | 16.93M    |
| slang       | 1.00x      | 24.825 ms | 31.50K  | 1.45M     |

### UniswapV3 (3189 LoC, 146583 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.39x      | 265.13 µs | 12.03M  | 552.87M   |
| solang   | 1.00x      | 634.82 µs | 5.02M   | 230.90M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 114.85x    | 589.96 µs | 5.41M   | 248.46M   |
| solang      | 22.11x     | 3.0647 ms | 1.04M   | 47.83M    |
| solc        | 14.26x     | 4.7512 ms | 671.18K | 30.85M    |
| tree-sitter | 11.53x     | 5.8754 ms | 542.77K | 24.95M    |
| slang       | 1.00x      | 67.757 ms | 47.07K  | 2.16M     |

### Solarray (1544 LoC, 35898 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.52x      | 184.73 µs | 8.36M   | 194.33M   |
| solang   | 1.00x      | 280.50 µs | 5.50M   | 127.98M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 128.06x    | 501.85 µs | 3.08M   | 71.53M    |
| solc        | 27.95x     | 2.2991 ms | 671.57K | 15.61M    |
| solang      | 25.67x     | 2.5041 ms | 616.59K | 14.34M    |
| tree-sitter | 15.61x     | 4.1172 ms | 375.01K | 8.72M     |
| slang       | 1.00x      | 64.268 ms | 24.02K  | 558.57K   |

### console (1552 LoC, 67315 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.73x      | 246.79 µs | 6.29M   | 272.76M   |
| solang   | 1.00x      | 428.11 µs | 3.63M   | 157.24M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 117.98x    | 595.99 µs | 2.60M   | 112.95M   |
| solang      | 22.31x     | 3.1512 ms | 492.51K | 21.36M    |
| solc        | 20.12x     | 3.4941 ms | 444.18K | 19.27M    |
| tree-sitter | 13.37x     | 5.2576 ms | 295.19K | 12.80M    |
| slang       | 1.00x      | 70.317 ms | 22.07K  | 957.31K   |

### Vm (1763 LoC, 91442 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.56x      | 154.42 µs | 11.42M  | 592.16M   |
| solang   | 1.00x      | 394.89 µs | 4.46M   | 231.56M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 62.78x     | 295.06 µs | 5.98M   | 309.91M   |
| solang      | 13.40x     | 1.3823 ms | 1.28M   | 66.15M    |
| tree-sitter | 7.63x      | 2.4263 ms | 726.62K | 37.69M    |
| solc        | 7.04x      | 2.6307 ms | 670.16K | 34.76M    |
| slang       | 1.00x      | 18.524 ms | 95.17K  | 4.94M     |

### safeconsole (13248 LoC, 397898 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.69x      | 1.3720 ms | 9.66M   | 290.01M   |
| solang   | 1.00x      | 2.3217 ms | 5.71M   | 171.38M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 90.32x     | 4.4731 ms | 2.96M   | 88.95M    |
| solang      | 20.39x     | 19.818 ms | 668.48K | 20.08M    |
| tree-sitter | 19.17x     | 21.070 ms | 628.76K | 18.88M    |
| solc        | 18.61x     | 21.709 ms | 610.23K | 18.33M    |
| slang       | 1.00x      | 404.00 ms | 32.79K  | 984.90K   |

### Seaport (19935 LoC, 770547 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.76x      | 1.0331 ms | 19.30M  | 745.86M   |
| solang   | 1.00x      | 2.8502 ms | 6.99M   | 270.35M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 117.21x    | 2.0130 ms | 9.90M   | 382.79M   |
| solang      | 24.25x     | 9.7302 ms | 2.05M   | 79.19M    |
| tree-sitter | 13.41x     | 17.595 ms | 1.13M   | 43.79M    |
| solc        | 11.68x     | 20.198 ms | 986.94K | 38.15M    |
| slang       | 1.00x      | 235.95 ms | 84.49K  | 3.27M     |

### Solady (31047 LoC, 1381235 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.96x      | 3.3679 ms | 9.22M   | 410.12M   |
| solang   | 1.00x      | 6.5885 ms | 4.71M   | 209.64M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 105.17x    | 7.4921 ms | 4.14M   | 184.36M   |
| solang      | 21.57x     | 36.527 ms | 849.97K | 37.81M    |
| solc        | 15.00x     | 52.545 ms | 590.86K | 26.29M    |
| tree-sitter | 14.21x     | 55.449 ms | 559.92K | 24.91M    |
| slang       | 1.00x      | 787.94 ms | 39.40K  | 1.75M     |

### Optimism (124413 LoC, 5383971 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.95x      | 13.906 ms | 8.95M   | 387.17M   |
| solang   | 1.00x      | 27.130 ms | 4.59M   | 198.45M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 171.62x    | 35.364 ms | 3.52M   | 152.24M   |
| solang      | 35.10x     | 172.93 ms | 719.44K | 31.13M    |
| solc        | 27.62x     | 219.75 ms | 566.13K | 24.50M    |
| tree-sitter | 17.68x     | 343.35 ms | 362.35K | 15.68M    |
| slang       | 1.00x      | 6.0690 s  | 20.50K  | 887.13K   |
