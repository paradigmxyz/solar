# solar-bench

Simple benchmarks across different Solidity parser implementations.

Requires cloning submodules: `git submodule update --init --checkout`.

Run with:

```bash
# Criterion
cargo bench -p solar-bench --bench criterion -- --quiet --format terse parser |& tee benches/criterion.out
uv --project benches/analyze run benches/analyze/main.py benches/README.md < benches/criterion.out

# iai - requires `valgrind` and `iai-callgrind-runner`
cargo bench -p solar-bench --bench iai
```

Currently this takes around 30 minutes to complete: `sources (12) * parsers (5) * lexers (2) * 15s`.

This crate is excluded from the main workspace to avoid compiling it (and its dependencies) when
invoking other commands such as `cargo test`.

## Results

You view the Solar-only results on [codspeed.io](https://codspeed.io/paradigmxyz/solar).

The following results were achieved on:
- Target: `x86_64-unknown-linux-gnu`
- CPU: AMD Ryzen 9 7950X
- Versions:
  - [`solc 0.8.28`](https://github.com/ethereum/solidity)
  - [`solar 0.1.2`](../README.md)
  - [`solang-parser 0.3.4`](https://crates.io/crates/solang-parser)
  - [`slang 0.18.3`](https://crates.io/crates/slang)
  - [`tree-sitter 0.25.4`](https://crates.io/crates/tree-sitter), [`tree-sitter-solidity 1.2.11`](https://crates.io/crates/tree-sitter-solidity)

<!-- AUTOGENERATED MARKER -->

![lex Relative Performance](lex_relative_performance.png)

![parse Relative Performance](parse_relative_performance.png)

### empty (0 LoC, 0 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solang   | 1.75x      | 8.0037 ns | N/A     | N/A       |
| solar    | 1.00x      | 14.811 ns | N/A     | N/A       |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solang      | 35.59x     | 104.03 ns | N/A     | N/A       |
| solar       | 22.85x     | 162.28 ns | N/A     | N/A       |
| tree-sitter | 6.07x      | 610.97 ns | N/A     | N/A       |
| solc        | 3.70x      | 1.0000 µs | N/A     | N/A       |
| slang       | 1.00x      | 3.7016 µs | N/A     | N/A       |

### Counter (14 LoC, 258 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.61x      | 692.64 ns | 20.23M  | 372.83M   |
| solang   | 1.00x      | 1.8037 µs | 7.76M   | 143.09M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 96.86x     | 2.1692 µs | 6.45M   | 118.95M   |
| solang      | 22.95x     | 9.1555 µs | 1.53M   | 28.18M    |
| tree-sitter | 18.28x     | 11.496 µs | 1.22M   | 22.44M    |
| solc        | 1.56x      | 134.30 µs | 104.24K | 1.92M     |
| slang       | 1.00x      | 210.09 µs | 66.64K  | 1.23M     |

### verifier (208 LoC, 11040 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.59x      | 29.222 µs | 7.12M   | 377.80M   |
| solang   | 1.00x      | 75.817 µs | 2.74M   | 145.61M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 147.88x    | 75.749 µs | 2.75M   | 145.74M   |
| solang      | 24.30x     | 460.95 µs | 451.24K | 23.95M    |
| tree-sitter | 15.10x     | 741.74 µs | 280.42K | 14.88M    |
| solc        | 7.08x      | 1.5814 ms | 131.53K | 6.98M     |
| slang       | 1.00x      | 11.202 ms | 18.57K  | 985.54K   |

### OptimizorClub (782 LoC, 35905 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.34x      | 100.37 µs | 7.79M   | 357.73M   |
| solang   | 1.00x      | 234.68 µs | 3.33M   | 153.00M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 132.34x    | 231.99 µs | 3.37M   | 154.77M   |
| solang      | 23.93x     | 1.2832 ms | 609.41K | 27.98M    |
| tree-sitter | 14.79x     | 2.0756 ms | 376.76K | 17.30M    |
| solc        | 6.86x      | 4.4738 ms | 174.80K | 8.03M     |
| slang       | 1.00x      | 30.701 ms | 25.47K  | 1.17M     |

### UniswapV3 (3189 LoC, 146583 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.58x      | 306.29 µs | 10.41M  | 478.58M   |
| solang   | 1.00x      | 789.61 µs | 4.04M   | 185.64M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 134.87x    | 611.68 µs | 5.21M   | 239.64M   |
| solang      | 24.03x     | 3.4323 ms | 929.11K | 42.71M    |
| tree-sitter | 14.34x     | 5.7525 ms | 554.37K | 25.48M    |
| solc        | 4.85x      | 17.006 ms | 187.51K | 8.62M     |
| slang       | 1.00x      | 82.495 ms | 38.66K  | 1.78M     |

### Solarray (1544 LoC, 35898 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.89x      | 171.89 µs | 8.98M   | 208.84M   |
| solang   | 1.00x      | 324.25 µs | 4.76M   | 110.71M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 169.48x    | 444.82 µs | 3.47M   | 80.70M    |
| solang      | 26.70x     | 2.8236 ms | 546.82K | 12.71M    |
| tree-sitter | 18.71x     | 4.0292 ms | 383.20K | 8.91M     |
| solc        | 14.96x     | 5.0378 ms | 306.48K | 7.13M     |
| slang       | 1.00x      | 75.388 ms | 20.48K  | 476.18K   |

### console (1552 LoC, 67315 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.10x      | 238.65 µs | 6.50M   | 282.07M   |
| solang   | 1.00x      | 501.76 µs | 3.09M   | 134.16M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 149.29x    | 557.54 µs | 2.78M   | 120.74M   |
| solang      | 23.44x     | 3.5502 ms | 437.16K | 18.96M    |
| tree-sitter | 16.29x     | 5.1086 ms | 303.80K | 13.18M    |
| solc        | 9.73x      | 8.5508 ms | 181.50K | 7.87M     |
| slang       | 1.00x      | 83.233 ms | 18.65K  | 808.75K   |

### Vm (1763 LoC, 91405 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 3.04x      | 159.89 µs | 11.03M  | 571.67M   |
| solang   | 1.00x      | 485.40 µs | 3.63M   | 188.31M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 73.84x     | 295.72 µs | 5.96M   | 309.09M   |
| solang      | 14.44x     | 1.5126 ms | 1.17M   | 60.43M    |
| tree-sitter | 9.45x      | 2.3101 ms | 763.17K | 39.57M    |
| solc        | 2.12x      | 10.275 ms | 171.57K | 8.90M     |
| slang       | 1.00x      | 21.835 ms | 80.74K  | 4.19M     |

### safeconsole (13248 LoC, 397898 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.00x      | 1.3438 ms | 9.86M   | 296.10M   |
| solang   | 1.00x      | 2.6879 ms | 4.93M   | 148.03M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 136.02x    | 3.3513 ms | 3.95M   | 118.73M   |
| solang      | 27.44x     | 16.610 ms | 797.59K | 23.96M    |
| tree-sitter | 23.91x     | 19.065 ms | 694.89K | 20.87M    |
| solc        | 9.33x      | 48.877 ms | 271.04K | 8.14M     |
| slang       | 1.00x      | 455.86 ms | 29.06K  | 872.85K   |

### Seaport (19935 LoC, 770547 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 3.10x      | 1.1181 ms | 17.83M  | 689.16M   |
| solang   | 1.00x      | 3.4628 ms | 5.76M   | 222.52M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 144.92x    | 2.0393 ms | 9.78M   | 377.85M   |
| solang      | 26.79x     | 11.030 ms | 1.81M   | 69.86M    |
| tree-sitter | 17.39x     | 16.991 ms | 1.17M   | 45.35M    |
| solc        | 3.47x      | 85.267 ms | 233.79K | 9.04M     |
| slang       | 1.00x      | 295.53 ms | 67.46K  | 2.61M     |

### Solady (31047 LoC, 1381235 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.26x      | 3.4934 ms | 8.89M   | 395.38M   |
| solang   | 1.00x      | 7.9076 ms | 3.93M   | 174.67M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 125.46x    | 7.2458 ms | 4.28M   | 190.63M   |
| solang      | 25.12x     | 36.195 ms | 857.77K | 38.16M    |
| tree-sitter | 19.18x     | 47.401 ms | 654.99K | 29.14M    |
| solc        | 5.71x      | 159.33 ms | 194.85K | 8.67M     |
| slang       | 1.00x      | 909.08 ms | 34.15K  | 1.52M     |

### Optimism (124413 LoC, 5383971 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.37x      | 13.852 ms | 8.98M   | 388.68M   |
| solang   | 1.00x      | 32.843 ms | 3.79M   | 163.93M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 291.55x    | 29.684 ms | 4.19M   | 181.38M   |
| solang      | 48.99x     | 176.66 ms | 704.25K | 30.48M    |
| tree-sitter | 28.91x     | 299.39 ms | 415.55K | 17.98M    |
| solc        | 13.98x     | 618.93 ms | 201.01K | 8.70M     |
| slang       | 1.00x      | 8.6543 s  | 14.38K  | 622.12K   |
