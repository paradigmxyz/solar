# solar-bench

Simple benchmarks across different Solidity parser implementations.

Requires cloning submodules: `git submodule update --init --checkout`.

Run with:

```bash
# Criterion
cargo criterion -p solar-bench --bench criterion -- --quiet --format terse |& tee benches/criterion.out
uv --project benches/analyze run benches/analyze/main.py benches/README.md < benches/criterion.out

# iai - requires `valgrind` and `iai-callgrind-runner`
cargo bench -p solar-bench --bench iai
```

This crate is excluded from the main workspace to avoid compiling it (and its dependencies) when
invoking other commands such as `cargo test`.

## Results

You view the Solar-only results on [codspeed.io](https://codspeed.io/paradigmxyz/solar).

The following results were achieved on:
- Target: `x86_64-unknown-linux-gnu`
- CPU: AMD Ryzen 9 7950X;
- Versions:
  - `solc 0.8.28`
  - `solar 0.1.2`
  - `solang-parser 0.3.4`
  - `slang 0.18.3`
  - `tree-sitter 0.25.3`, `tree-sitter-solidity 1.2.11`

<!-- AUTOGENERATED MARKER -->

![lex Relative Performance](lex_relative_performance.png)

![parse Relative Performance](parse_relative_performance.png)

### empty (0 LoC, 0 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solang   | 16.86x     | 7.9696 ns | N/A     | N/A       |
| solar    | 1.00x      | 118.93 ns | N/A     | N/A       |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solang      | 31.90x     | 102.08 ns | N/A     | N/A       |
| solar       | 10.14x     | 321.88 ns | N/A     | N/A       |
| tree-sitter | 8.43x      | 386.41 ns | N/A     | N/A       |
| solc        | 3.25x      | 1.0000 µs | N/A     | N/A       |
| slang       | 1.00x      | 3.2549 µs | N/A     | N/A       |

### Counter (14 LoC, 258 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.57x      | 899.51 ns | 15.57M  | 286.99M   |
| solang   | 1.00x      | 1.4094 µs | 9.94M   | 183.11M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 75.04x     | 2.3888 µs | 5.86M   | 108.04M   |
| solang      | 18.01x     | 9.9519 µs | 1.41M   | 25.93M    |
| tree-sitter | 14.91x     | 12.017 µs | 1.17M   | 21.47M    |
| solc        | 5.41x      | 33.100 µs | 422.96K | 7.79M     |
| slang       | 1.00x      | 179.20 µs | 78.12K  | 1.44M     |

### verifier (208 LoC, 11040 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.67x      | 34.540 µs | 6.02M   | 319.63M   |
| solang   | 1.00x      | 57.835 µs | 3.60M   | 190.89M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 109.37x    | 84.023 µs | 2.48M   | 131.39M   |
| solang      | 22.41x     | 410.09 µs | 507.21K | 26.92M    |
| solc        | 14.65x     | 627.40 µs | 331.53K | 17.60M    |
| tree-sitter | 13.00x     | 706.64 µs | 294.35K | 15.62M    |
| slang       | 1.00x      | 9.1896 ms | 22.63K  | 1.20M     |

### OptimizorClub (782 LoC, 35905 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.63x      | 108.29 µs | 7.22M   | 331.56M   |
| solang   | 1.00x      | 176.56 µs | 4.43M   | 203.36M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 99.40x     | 249.18 µs | 3.14M   | 144.09M   |
| solang      | 20.59x     | 1.2031 ms | 649.99K | 29.84M    |
| solc        | 16.05x     | 1.5437 ms | 506.58K | 23.26M    |
| tree-sitter | 12.27x     | 2.0179 ms | 387.53K | 17.79M    |
| slang       | 1.00x      | 24.769 ms | 31.57K  | 1.45M     |

### UniswapV3 (3189 LoC, 146583 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.95x      | 305.26 µs | 10.45M  | 480.19M   |
| solang   | 1.00x      | 595.69 µs | 5.35M   | 246.07M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 105.01x    | 637.79 µs | 5.00M   | 229.83M   |
| solang      | 21.62x     | 3.0981 ms | 1.03M   | 47.31M    |
| solc        | 14.50x     | 4.6175 ms | 690.63K | 31.75M    |
| tree-sitter | 11.67x     | 5.7369 ms | 555.88K | 25.55M    |
| slang       | 1.00x      | 66.975 ms | 47.61K  | 2.19M     |

### Solarray (1544 LoC, 35898 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.36x      | 200.83 µs | 7.69M   | 178.75M   |
| solang   | 1.00x      | 274.07 µs | 5.63M   | 130.98M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 121.23x    | 521.95 µs | 2.96M   | 68.78M    |
| solc        | 28.25x     | 2.2401 ms | 689.25K | 16.03M    |
| solang      | 24.93x     | 2.5381 ms | 608.33K | 14.14M    |
| tree-sitter | 15.84x     | 3.9947 ms | 386.51K | 8.99M     |
| slang       | 1.00x      | 63.276 ms | 24.40K  | 567.32K   |

### console (1552 LoC, 67315 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.54x      | 276.83 µs | 5.61M   | 243.16M   |
| solang   | 1.00x      | 426.51 µs | 3.64M   | 157.83M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 110.99x    | 611.12 µs | 2.54M   | 110.15M   |
| solang      | 21.29x     | 3.1855 ms | 487.21K | 21.13M    |
| solc        | 19.45x     | 3.4870 ms | 445.08K | 19.30M    |
| tree-sitter | 13.35x     | 5.0794 ms | 305.55K | 13.25M    |
| slang       | 1.00x      | 67.826 ms | 22.88K  | 992.47K   |

### Vm (1763 LoC, 91405 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 2.06x      | 178.49 µs | 9.88M   | 512.10M   |
| solang   | 1.00x      | 367.60 µs | 4.80M   | 248.65M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 57.13x     | 316.81 µs | 5.56M   | 288.52M   |
| solang      | 13.28x     | 1.3625 ms | 1.29M   | 67.09M    |
| tree-sitter | 7.77x      | 2.3295 ms | 756.81K | 39.24M    |
| solc        | 6.72x      | 2.6931 ms | 654.64K | 33.94M    |
| slang       | 1.00x      | 18.099 ms | 97.41K  | 5.05M     |

### safeconsole (13248 LoC, 397898 bytes)

#### Lex
| Parser   | Relative   | Time      | LoC/s   | Bytes/s   |
|:---------|:-----------|:----------|:--------|:----------|
| solar    | 1.49x      | 1.5034 ms | 8.81M   | 264.67M   |
| solang   | 1.00x      | 2.2348 ms | 5.93M   | 178.05M   |

#### Parse
| Parser      | Relative   | Time      | LoC/s   | Bytes/s   |
|:------------|:-----------|:----------|:--------|:----------|
| solar       | 84.44x     | 4.6864 ms | 2.83M   | 84.90M    |
| solang      | 21.31x     | 18.566 ms | 713.56K | 21.43M    |
| tree-sitter | 19.70x     | 20.082 ms | 659.70K | 19.81M    |
| solc        | 18.95x     | 20.884 ms | 634.36K | 19.05M    |
| slang       | 1.00x      | 395.70 ms | 33.48K  | 1.01M     |
